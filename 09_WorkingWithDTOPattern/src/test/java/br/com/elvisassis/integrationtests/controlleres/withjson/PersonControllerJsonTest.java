package br.com.elvisassis.integrationtests.controlleres.withjson;import br.com.elvisassis.config.TestConfigs;import br.com.elvisassis.integrationtests.dto.PersonDTO;import br.com.elvisassis.integrationtests.testconstainers.AbstractIntegrationTest;import com.fasterxml.jackson.core.JsonProcessingException;import com.fasterxml.jackson.core.type.TypeReference;import com.fasterxml.jackson.databind.DeserializationFeature;import com.fasterxml.jackson.databind.ObjectMapper;import io.restassured.builder.RequestSpecBuilder;import io.restassured.filter.log.LogDetail;import io.restassured.filter.log.RequestLoggingFilter;import io.restassured.filter.log.ResponseLoggingFilter;import io.restassured.specification.RequestSpecification;import lombok.extern.slf4j.Slf4j;import org.junit.jupiter.api.*;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.http.MediaType;import java.util.List;import static io.restassured.RestAssured.given;import static junit.framework.TestCase.*;@Slf4j@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)@TestMethodOrder(MethodOrderer.OrderAnnotation.class)class PersonControllerJsonTest extends AbstractIntegrationTest {    private static RequestSpecification specification;    private static ObjectMapper objectMapper;    private static PersonDTO person;    @BeforeAll    static void setUp() {        objectMapper = new ObjectMapper();        objectMapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);        person = new PersonDTO();    }    @Test    @Order(1)    void createTest() throws JsonProcessingException {        mockPerson();        specification = new RequestSpecBuilder()                .addHeader(TestConfigs.HEADER_PARAM_ORIGIN, TestConfigs.ORIGIN_ERUDIO)                .setBasePath("/api/person/v1")                .setPort(8888)                .addFilter(new RequestLoggingFilter(LogDetail.ALL))                .addFilter(new ResponseLoggingFilter(LogDetail.ALL))                .build();        var content = given(specification)                .contentType(MediaType.APPLICATION_JSON_VALUE)                    .body(person)                .when()                    .post()                .then()                    .statusCode(201)                    .contentType(MediaType.APPLICATION_JSON_VALUE)                .extract()                    .body()                        .asString();        PersonDTO createPerson = objectMapper.readValue(content, PersonDTO.class);        person = createPerson;        assertNotNull(createPerson.getId());        assertTrue(createPerson.getId() > 0);        assertEquals("Elvis", createPerson.getFirstName());        assertEquals("Assis", createPerson.getLastName());        assertEquals("Rosário do Rio Grande - Minas Gerais - Brasil", createPerson.getAddress());        assertEquals("Male", createPerson.getGender());        assertTrue(createPerson.getEnabled());    }    @Test    @Order(2)    void updateTest() throws JsonProcessingException {        person.setLastName("Keslei de Assis");        var content = given(specification)                .contentType(MediaType.APPLICATION_JSON_VALUE)                    .body(person)                .when()                    .put()                .then()                    .statusCode(200)                    .contentType(MediaType.APPLICATION_JSON_VALUE)                .extract()                    .body()                        .asString();        PersonDTO createPerson = objectMapper.readValue(content, PersonDTO.class);        person = createPerson;        assertNotNull(createPerson.getId());        assertTrue(createPerson.getId() > 0);        assertEquals("Elvis", createPerson.getFirstName());        assertEquals("Keslei de Assis", createPerson.getLastName());        assertEquals("Rosário do Rio Grande - Minas Gerais - Brasil", createPerson.getAddress());        assertEquals("Male", createPerson.getGender());        assertTrue(createPerson.getEnabled());    }    @Test    @Order(3)    void findByIdTest() throws JsonProcessingException {        var content = given(specification)                .contentType(MediaType.APPLICATION_JSON_VALUE)                    .pathParam("id", person.getId())                .when()                .   get("{id}")                .then()                    .statusCode(200)                    .contentType(MediaType.APPLICATION_JSON_VALUE)                .extract()                    .body()                        .asString();        PersonDTO createdPerson = objectMapper.readValue(content, PersonDTO.class);        person = createdPerson;        assertNotNull(createdPerson.getId());        assertTrue(createdPerson.getId() > 0);        assertEquals("Elvis", createdPerson.getFirstName());        assertEquals("Keslei de Assis", createdPerson.getLastName());        assertEquals("Rosário do Rio Grande - Minas Gerais - Brasil", createdPerson.getAddress());        assertEquals("Male", createdPerson.getGender());        assertTrue(createdPerson.getEnabled());    }    @Test    @Order(4)    void disableTest() throws JsonProcessingException {        var content = given(specification)                .contentType(MediaType.APPLICATION_JSON_VALUE)                    .pathParam("id", person.getId())                .when()                    .patch("{id}")                .then()                    .statusCode(200)                    .contentType(MediaType.APPLICATION_JSON_VALUE)                .extract()                    .body()                        .asString();        PersonDTO createdPerson = objectMapper.readValue(content, PersonDTO.class);        person = createdPerson;        assertNotNull(createdPerson.getId());        assertTrue(createdPerson.getId() > 0);        assertEquals("Elvis", createdPerson.getFirstName());        assertEquals("Keslei de Assis", createdPerson.getLastName());        assertEquals("Rosário do Rio Grande - Minas Gerais - Brasil", createdPerson.getAddress());        assertEquals("Male", createdPerson.getGender());        assertFalse(createdPerson.getEnabled());    }    @Test    @Order(5)    void deleteTest() throws JsonProcessingException {        given(specification)                    .pathParam("id", person.getId())                .when()                    .delete("{id}")                .then()                    .statusCode(204);    }    @Test    @Order(6)    void findAllTest() throws JsonProcessingException {        var content = given(specification)                .contentType(MediaType.APPLICATION_JSON_VALUE)                .when()                    .get()                .then()                    .statusCode(200)                .contentType(MediaType.APPLICATION_JSON_VALUE)                    .extract()                        .body()                            .asString();        List<PersonDTO> people = objectMapper.readValue(content, new TypeReference<List<PersonDTO>>() {});        PersonDTO personOne = people.get(0);        person = personOne;        assertNotNull(personOne.getId());        assertTrue(personOne.getId() > 0);        assertEquals("Elvis", personOne.getFirstName());        assertEquals("Assis", personOne.getLastName());        assertEquals("Rosário do Rio Grande - Minas Gerais - Brasil", personOne.getAddress());        assertEquals("Male", personOne.getGender());        assertTrue(personOne.getEnabled());        PersonDTO personTwo = people.get(1);        person = personTwo;        assertNotNull(personTwo.getId());        assertTrue(personTwo.getId() > 0);        assertEquals("Bia", personTwo.getFirstName());        assertEquals("Verde Reis", personTwo.getLastName());        assertEquals("Macapa - Amapá - Brasil", personTwo.getAddress());        assertEquals("Female", personTwo.getGender());        assertTrue(personTwo.getEnabled());    }    private void mockPerson() {        person.setFirstName("Elvis");        person.setLastName("Assis");        person.setAddress("Rosário do Rio Grande - Minas Gerais - Brasil");        person.setGender("Male");        person.setEnabled(true);    }}